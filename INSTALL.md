# Руководство по установке Codev для AI-агентов

## Обзор

Этот документ предоставляет инструкции для AI-агентов по установке фреймворка методологии Codev в проект пользователя. Codev - это контекстно-ориентированная методология разработки, использующая структурированные протоколы для управления совместной разработкой программного обеспечения.

### Основные принципы
1. **Контекст управляет кодом** - Определения контекста переходят от высокоуровневых спецификаций к деталям реализации
2. **Сотрудничество человека и AI** - Разработано для бесшовного взаимодействия между разработчиками и AI-агентами
3. **Эволюционирующая методология** - Процесс сам развивается и улучшается с каждым проектом

## Процесс установки

### Шаг 1: Проверка предварительных условий

Когда пользователь запрашивает установку Codev, сначала определите, какой вариант протокола установить:

```bash
# Проверьте, доступен ли сервер Zen MCP
mcp list
# или попробуйте
mcp__zen__version
```

**Дерево решений**:
- Если Zen MCP доступен → Установите протокол **SPIDER** (с мультиагентной консультацией)
- Если Zen MCP недоступен:
  - Спросите: "Сервер Zen MCP не обнаружен. Что вы хотите сделать:"
    1. "Установить сервер Zen MCP для функций мультиагентной консультации"
    2. "Использовать протокол SPIDER-SOLO (вариант с одним агентом)"

### Шаг 2: Создание и заполнение каталога Codev

**ВАЖНО**: Все файлы Codev должны находиться ВНУТРИ каталога `codev/`, а не в корне проекта!

```bash
# Клонируйте репозиторий codev во временный каталог
TEMP_DIR=$(mktemp -d)
git clone --depth 1 https://github.com/ansari-project/codev.git "$TEMP_DIR"

# Скопируйте структуру skeleton в ваш проект
mkdir -p codev
cp -r "$TEMP_DIR/codev-skeleton/"* ./codev/

# Скопируйте каталог .claude с агентами в корень проекта
cp -r "$TEMP_DIR/codev-skeleton/.claude" ./

# Создайте необходимые каталоги (убедитесь, что они существуют, даже если skeleton неполный)
mkdir -p codev/specs
mkdir -p codev/plans

# Очистка
rm -rf "$TEMP_DIR"
```

**Структура каталогов должна быть**:
```
project-root/
├── codev/              # Все файлы Codev находятся здесь!
│   ├── protocols/      # Определения протоколов
│   ├── specs/          # Спецификации
│   ├── plans/          # Планы реализации
│   ├── reviews/        # Обзоры и извлечённые уроки
│   └── resources/      # Справочные материалы и документация
├── .claude/            # Определения AI-агентов
│   └── agents/         # Пользовательские агенты
│       ├── spider-protocol-updater.md
│       └── architecture-documenter.md
├── CLAUDE.md           # В корне проекта
└── [файлы проекта]     # Ваш фактический код
```

### Шаг 3: Выбор протокола

Весь каталог `codev/protocols/` копируется со всеми доступными протоколами. Активный протокол выбирается путём изменения файла CLAUDE.md для ссылки на соответствующий путь протокола.

Доступные протоколы:
- `codev/protocols/spider/` - Полный SPIDER с мультиагентной консультацией
- `codev/protocols/spider-solo/` - Вариант с одним агентом
- `codev/protocols/tick/` - Быстрая автономная реализация для простых задач

### Шаг 4: Создание или обновление CLAUDE.md

**ВАЖНО**: Проверьте, существует ли CLAUDE.md, прежде чем изменять его!

```bash
# Проверьте, существует ли CLAUDE.md
if [ -f "CLAUDE.md" ]; then
    echo "CLAUDE.md существует. Обновляем для включения ссылок на Codev..."
    # ДОБАВЬТЕ инструкции Codev к существующему файлу
else
    # Запросите разрешение у пользователя
    echo "CLAUDE.md не найден. Могу ли я создать его? [y/n]"
    # Если да, создайте базовый CLAUDE.md со структурой Codev
    # Примечание: В skeleton нет шаблона - AI должен создать подходящий на основе контекста проекта
fi
```

**При обновлении существующего CLAUDE.md**, добавьте эти разделы:
```markdown
## Методология Codev

Этот проект использует контекстно-ориентированную методологию разработки Codev.

### Активный протокол
- Протокол: SPIDER (или SPIDER-SOLO)
- Расположение: codev/protocols/spider/protocol.md

### Структура каталогов
- Спецификации: codev/specs/
- Планы: codev/plans/
- Обзоры: codev/reviews/
- Ресурсы: codev/resources/

См. codev/protocols/spider/protocol.md для полных деталей протокола.
```

Ключевые разделы для проверки в CLAUDE.md:
- Путь активного протокола
- Руководство по консультациям (если используется SPIDER)
- Соглашения об именовании файлов (####-описательное-имя.md)

### Шаг 5: Проверка установки

**Быстрый контрольный список**:
```bash
# 1. Проверьте, что каталог codev/ существует
test -d codev && echo "✓ каталог codev/ существует" || echo "✗ ОШИБКА: каталог codev/ отсутствует"

# 2. Проверьте необходимые подкаталоги
test -d codev/protocols/spider && echo "✓ протокол SPIDER существует" || echo "✗ ОШИБКА: протокол SPIDER отсутствует"
test -d codev/protocols/tick && echo "✓ протокол TICK существует" || echo "✗ ОШИБКА: протокол TICK отсутствует"
test -d codev/specs && echo "✓ каталог specs/ существует" || echo "✗ ОШИБКА: каталог specs/ отсутствует"
test -d .claude/agents && echo "✓ каталог .claude/agents/ существует" || echo "✗ ОШИБКА: каталог .claude/agents/ отсутствует"

# 3. Проверьте, что протокол читается
test -r codev/protocols/spider/protocol.md && echo "✓ protocol.md читается" || echo "✗ ОШИБКА: Не удаётся прочитать protocol.md"

# 4. Проверьте, что CLAUDE.md ссылается на codev
grep -q "codev" CLAUDE.md && echo "✓ CLAUDE.md ссылается на codev" || echo "✗ ОШИБКА: CLAUDE.md не содержит ссылок на codev"
```

**Подробная проверка структуры**:
```bash
# Просмотрите полную структуру каталогов
find codev -type d -maxdepth 2 | sort

# Ожидаемый вывод:
# codev/
# codev/plans
# codev/protocols
# codev/protocols/spider
# codev/protocols/spider-solo
# codev/reviews
# codev/resources
# codev/specs

# Проверьте содержимое протокола
cat codev/protocols/spider/protocol.md | head -20
```

## Руководство после установки

После установки направьте пользователя:

1. **Первая спецификация**: "Что вы хотите создать первым? Я могу помочь создать спецификацию. Какой протокол вы предпочитаете - SPIDER (с мультиагентной консультацией) или SPIDER-SOLO?"

2. **Объясните процесс**:
   - **Создание по фазам с использованием цикла IDE**:
     - **I**mplement (Реализация): Создайте код
     - **D**efend (Защита): Напишите всесторонние тесты
     - **E**valuate (Оценка): Проверьте выполнение требований
   - Каждая фаза следует: Спецификация → План → Цикл IDE → Обзор

3. **Именование документов**: Всегда используйте формат ####-описательное-имя.md

4. **Интеграция с Git**:
   - Каждая стадия получает один pull request
   - Фазы могут иметь несколько коммитов
   - Требуется одобрение пользователя перед PR

## Устранение неполадок

### Распространённые проблемы:

**Вопрос: Пользователь хочет мультиагентную консультацию, но Zen MCP не работает**
- Попробуйте: "Позвольте мне сначала помочь вам установить сервер Zen MCP"
- Запасной вариант: "Мы можем начать со SPIDER-SOLO и мигрировать позже"

**Вопрос: У пользователя существующий каталог codev**
- Спросите: "У вас существующий каталог codev/. Должен ли я:"
  - "Создать резервную копию и переустановить"
  - "Обновить только протокол"
  - "Сохранить существующую настройку"

**Вопрос: Пользователь хочет другое имя протокола**
- Протоколы можно переименовать, просто убедитесь:
  - Имя каталога соответствует ссылкам в CLAUDE.md
  - Все шаблоны присутствуют
  - manifest.yaml обновлён

## Сравнение протоколов

| Функция | SPIDER | SPIDER-SOLO |
|---------|--------|-------------|
| Мультиагентная консультация | ✓ (GPT-5 + Gemini Pro) | ✗ (только самопроверка) |
| Предварительные условия | Сервер Zen MCP | Нет |
| Обзоры спецификаций | Мультиагентный внешний | Самопроверка |
| Обзоры планов | Мультиагентный внешний | Самопроверка |
| Обзоры реализации | Мультиагентный по фазам | Самопроверка |
| Лучше всего для | Продакшен-функций | Исследования и прототипов |
| Скорость | Медленнее (тщательно) | Быстрее (достаточно хорошо) |

## Опционально: Агент Spider Protocol Updater

Для проектов, использующих Claude Code с инструментом Task, вы можете установить агента `spider-protocol-updater`, чтобы помочь развивать протокол SPIDER, обучаясь на других реализациях:

**Установка**:
```bash
# Создайте каталог .claude/agents, если его нет
mkdir -p .claude/agents

# Скопируйте агента spider-protocol-updater из исходников codev
# (Предполагается, что исходники codev доступны)
cp path/to/codev-skeleton/.claude/agents/spider-protocol-updater.md .claude/agents/

# Также скопируйте агента architecture-documenter (для поддержки протокола TICK)
cp path/to/codev-skeleton/.claude/agents/architecture-documenter.md .claude/agents/
```

**Что делают агенты**:

**spider-protocol-updater**:
- Анализирует реализации SPIDER в других GitHub-репозиториях
- Идентифицирует улучшения и извлечённые уроки
- Рекомендует обновления протокола на основе использования сообществом
- Помогает протоколу эволюционировать через коллективную мудрость

**architecture-documenter**:
- Поддерживает всестороннюю документацию архитектуры (arch.md)
- Документирует структуру каталогов, утилиты и паттерны проектирования
- Автоматически вызывается в конце обзоров протокола TICK
- Помогает разработчикам быстро понять структуру кодовой базы

**Как использовать**:
```bash
# Проверьте конкретный репозиторий на улучшения
"Проверь репозиторий ansari-project/webapp на любые улучшения SPIDER"

# Периодический обзор реализаций SPIDER
"Просканируй последние реализации SPIDER на улучшения протокола"
```

**Примечание**: Эти агенты требуют:
- Claude Code с поддержкой инструмента Task
- Доступ к GitHub-репозиториям (для spider-protocol-updater)
- Файлы агентов в `.claude/agents/`

## Помните

- Цель - ТРИ документа на функцию (спецификация, план, обзор)
- Каждая стадия получает один pull request
- Фазы могут иметь несколько коммитов внутри PR
- Требуется одобрение пользователя перед созданием PR
- Контекст управляет разработкой
